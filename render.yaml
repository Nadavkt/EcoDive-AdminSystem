services:
  - type: web
    name: admin-system-server
    env: node
    buildCommand: |
      echo "Installing Client dependencies..."
      npm --prefix Client install
      echo "Building Client..."
      npm --prefix Client run build
      echo "Checking build output..."
      ls -la Client/dist/ || echo "Client/dist not found"
      echo "Installing Server dependencies..."
      npm --prefix Server ci || (cd Server && npm install)
    startCommand: npm --prefix Server start
    envVars:
      - key: NODE_ENV
        value: production
      # Set this in Render dashboard to your RDS or Render PostgreSQL
      - key: DATABASE_URL
        sync: false
    autoDeploy: true
    plan: free
    healthCheckPath: /healthz
    postDeployCommand: npm --prefix Server run migrate

